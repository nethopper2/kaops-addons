global:
  # This is used to allow insecure images to be pulled from the bitnamilegacy registry
  security:
    allowInsecureImages: true
  enableSSO: false
  extraEnvVarsCM: shared-configmap-rag
  extraEnvVarsSecret: shared-secrets-rag
  googleApplicationCredentialsSecretRef: # user provided
  awsOpenAIKeySecretRef: # user provided
  sendgridSecretRef: "sendgrid-secret"
  postgresql:
    auth:
      username: postgres
      existingSecret: postgresql-password
      secretKeys:
        adminPasswordKey: postgresPassword
  llmBaseUrl: http://open-webui-ollama:11434
  secretArgocdHook: Skip
  nodeEnv: production
  juiceFsUrl: # system provided
dataIngestion:
  enabled: false
  config:
    dataSourcesUrl:
    overideWebSocketUrl:
    dataIngestionCredentialsRef:
    serviceUrl: # system provided
ingress:
  enabled: true
  ignoreSSL: false
  increaseBuffersSize: false
  class: nginx
  oauthProviderName:
  oauth2Proxy:
    enabled: true
    adminEmail: "admin@nethopper.io"
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: "true"
    nginx.ingress.kubernetes.io/backend-protocol: http
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/tls-acme: "true"
  host:
  additionalHosts: []
  tls:
    - hosts:
open-webui:
  image:
    repository: nethopper/kaops-open-webui
    tag: "v1.101.0-slim"
    pullPolicy: IfNotPresent
  ollama:
    persistentVolume:
      enabled: true
    ollama:
      gpu:
        enabled: false
      models:
        pull: []
    service:
      type: ClusterIP
  extraEnvFrom:
    - configMapRef:
        name: shared-configmap-rag
  extraEnvVars:
    - name: WEBUI_NAME
      value: "Private AI"
    - name: ENABLE_CODE_EXECUTION
      value: "false"
    - name: ENABLE_CODE_INTERPRETER
      value: "false"
    - name: ENABLE_EVALUATION_ARENA_MODELS
      value: "false"
    - name: ENABLE_GOOGLE_DRIVE_INTEGRATION
      value: "true"
    - name: ENABLE_ONEDRIVE_INTEGRATION
      value: "true"
    - name: BYPASS_EMBEDDING_AND_RETRIEVAL
      value: "true"
    - name: BYPASS_MODEL_ACCESS_CONTROL
      value: "true"
    - name: USER_PERMISSIONS_WORKSPACE_KNOWLEDGE_ACCESS
      value: "true"
    - name: USER_PERMISSIONS_CHAT_CONTROLS
      value: "false"
    - name: USER_PERMISSIONS_WORKSPACE_PROMPTS_ACCESS
      value: "true"
    - name: WEBUI_AUTH
      value: "true"
    - name: API_KEY_ALLOWED_ENDPOINTS
      value: /api/v1/knowledge/,/api/v1/knowledge/list
    - name: WEBUI_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: shared-secrets-rag
          key: JWT_SECRET_KEY
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: shared-secrets-rag
          key: DATABASE_URL
    - name: JUICEFS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: juicefs-s3-gateway
          key: minio-root-user
    - name: JUICEFS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: juicefs-s3-gateway
          key: minio-root-password
    - name: JUICEFS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: juicefs-s3-gateway
          key: name
  copyAppData:
    command:
      - sh
      - "-c"
      - >-
        if [ "$(ls -A /app/backend/data 2>/dev/null)" ]; then cp -r
        /app/backend/data/* /tmp/app-data/; else echo 'No data to copy,
        directory is empty'; fi
postgresql:
  image:
    repository: bitnamilegacy/postgresql
  metrics:
    image:
      repository: bitnamilegacy/postgres-exporter
    enabled: true
    serviceMonitor:
      enabled: true
      labels:
        release: # system provided
  primary:
    resourcesPreset: medium
    initdb:
      scripts:
        01-init.sql: |
          CREATE DATABASE "open-webui" WITH OWNER postgres;
          CREATE DATABASE "private-ai-rag" WITH OWNER postgres;
          CREATE DATABASE "private-ai-rest" WITH OWNER postgres;
          CREATE DATABASE "juicefs" WITH OWNER postgres;
rag:
  allowedExtensions: "pdf,docx,xlsx,pptx,txt,json,md"
  custom:
    {}
    # logo: # user provided
    # bgImageAuth: # user provided
    # bgMovieAuth: # user provided
    # sector:  # user provided
  dataServiceUrl: # user provided
  dataServiceUrlBackend: # user provided
  ragApiUrl: # user provided
  allowedCorsOrigin: # system provided
  # googleAllowedExtensions: # user provided
  gcsBucketName: # user provided
  googleApiScopes: # system provided
  postgresHost: # system provided

initdb:
  enabled: false
  image:
    repository: postgres
    tag: "16"
    pullPolicy: IfNotPresent
  postgresql:
    port: "5432"
    database: "postgres"
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

postInstall:
  chosenPostInstallOptions: "suggested"

backups:
  enabled: false
  schedule: "0 */8 * * *"
  # For GCS backups:
  # gcsBucketName: # user provided
  # googleApplicationCredentialsSecretRef: defaults to global.googleApplicationCredentialsSecretRef
  # For S3 backups:
  # s3BucketName: # user provided
  # s3Region: # user provided (e.g., us-east-1)
  # s3AccessKeySecretRef: # user provided (secret name containing AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY) - not needed if using serviceAccountName
  # serviceAccountName: # user provided (for IRSA/service account based authentication instead of access keys)
  type: gcs # Options: gcs, s3

nh-rag-api:
  enabled: false
  image:
    tag: "v1.101.0"
  env:
    LLAMAINDEX_OLLAMA_BASE_URL: http://open-webui-ollama:11434
    QDRANT_URL: # system provided
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      labels:
        release: # system provided
  config:
    juiceFsSecretName: "juicefs-s3-gateway"
    juiceFsUrl: "" # system provided
  livenessProbe:
    failureThreshold: 3
    initialDelaySeconds: 65
    periodSeconds: 60
    timeoutSeconds: 120
  readinessProbe:
    failureThreshold: 3
    periodSeconds: 30
    timeoutSeconds: 15
  worker:
    enabled: true
    image:
      tag: "v1.101.0"
    livenessProbe:
      failureThreshold: 3
      initialDelaySeconds: 65
      periodSeconds: 60
      timeoutSeconds: 120
    readinessProbe:
      failureThreshold: 3
      initialDelaySeconds: 30
      periodSeconds: 60
      timeoutSeconds: 120
    replicaCount: 10

redis:
  image:
    repository: bitnamilegacy/redis
  enabled: false
  architecture: standalone
  auth:
    enabled: false
  master:
    persistence:
      enabled: true
      size: 8Gi
      storageClass: "" # Optionally set your storage class
    resourcesPreset: medium
  replica:
    replicaCount: 0
  metrics:
    image:
      repository: bitnamilegacy/redis-exporter
    enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: # system provided

qdrant:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: # system provided
  resources:
    limits:
      cpu: 4000m
    requests:
      cpu: 500m

juicefs-s3-gateway:
  enabled: false
  secret:
    name: "juicefs-s3-gateway"
    create: true
    config:
      name: "juicefs-volume"
      storage: "" # user provided
      bucket: "" # user provided
      metaurl: "" # system provided
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: # system provided
  configMap:
    webhookEndpoint: # user provided
  persistence:
    enabled: true
  sidecar:
    enabled: true
    keepRunning: true
  fuse:
    enabled: true

nh-pai-data-service:
  image:
    tag: "v1.101.0"
  ingress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      kubernetes.io/ingress.class: nginx
      kubernetes.io/tls-acme: "true"
      nginx.ingress.kubernetes.io/backend-protocol: http
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/tls-acme: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: 100m
    hosts:
      - host: # system provided
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls:
      - secretName: nh-pai-data-service-tls
        hosts: # system provided
  enabled: false
  config:
    postgresDatabase: "pai-data-rest-service"
    juiceFsSecretName: "juicefs-s3-gateway"
    juiceFsUrl: "" # system provided
    feedbackEmail:
      enabled: "true"
      recipients: "feedback@nethopper.io"
      customerName: "Not Provided!" # user provided
  autoRunMigrations: "true"
  livenessProbe:
    failureThreshold: 3
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 60
    successThreshold: 1
    timeoutSeconds: 15
  readinessProbe:
    failureThreshold: 3
    httpGet:
      path: /health
      port: http
    periodSeconds: 30
    successThreshold: 1
    timeoutSeconds: 10
  worker:
    enabled: false

nh-mcp-server:
  enabled: true
  image:
    tag: "v1.101.1"

nh-data-ingestion:
  enabled: true
  api:
    image:
      tag: "v1.101.1"
  flower:
    image:
      tag: "v1.101.1"
  scheduler:
    image:
      tag: "v1.101.1"
  worker:
    image:
      tag: "v1.101.1"

heartbeatMonitoring:
  enabled: false  # Disabled by default
  schedule: "* * * * *"  # Every minute
  
  image:
    repository: curlimages/curl
    tag: "8.5.0"
  
  # Health check settings
  timeout: 10  # seconds for health check
  retries: 3   # number of retry attempts
  retryDelay: 5  # seconds between retries
  insecureSkipVerify: false  # Set to true to ignore SSL certificate validation for all service health checks
  
  # Built-in services (URLs auto-resolved from release name)
  builtInServices:
    openWebui:
      enabled: true
      healthPath: "/health"
      heartbeatUrl: ""  # UptimeRobot heartbeat URL
    dataService:
      enabled: true
      healthPath: "/health"
      heartbeatUrl: ""  # UptimeRobot heartbeat URL
  
  # Additional services to monitor
  services: []
  # - name: my-custom-service
  #   url: "http://my-service:8080"
  #   healthPath: "/health"
  #   heartbeatUrl: "https://heartbeat.uptimerobot.com/xxx"
  
  # Optional: reference external secret for heartbeat URLs (overrides inline values)
  externalSecretRef: ""
